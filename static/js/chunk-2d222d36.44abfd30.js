(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d222d36"],{cfeb:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("blog",{attrs:{content:e.content,"current-issue":e.currentIssue},on:{commitComment:e.handlerCommitComment,sign:e.sign}})},s=[],r=n("5530"),i=(n("7514"),n("5df3"),n("1c4c"),n("8d84")),c=n("3edf"),a=n("ed08"),l=n("5f87"),u={lock:!0,text:"Loading"},h={name:"Details",components:{Blog:i["a"]},data:function(){return{content:"",currentIssue:{},loading:null}},created:function(){var e=this.$route.params.sha;this.getBlogDetails(e),this.initIssues()},destroyed:function(){this.loading&&this.loading.close()},updated:function(){var e=document.querySelector("#markdown-content");if(e){for(var t=Array.from(e.querySelectorAll("h1,h2,h3,h4,h5,h6")),n=[],o=0,s=t;o<s.length;o++){var r=s[o];n.push(this.treeDecoration(r))}this.$store.dispatch("app/setPostDirectory",n)}},methods:{getBlogDetails:function(e){var t=this;this.loading=this.$loading(u),Object(c["g"])(e).then((function(e){t.content=e.content})).catch((function(e){console.log("getBlogDetails",e),t.loading.close()})).finally((function(){t.loading.close(),t.$nextTick((function(){return t.initDomTree()}))}))},treeDecoration:function(e){var t=e.tagName.substring(1,2),n=e.innerHTML;if(t>1){n="- "+n;for(var o=0;o<t-1;o++)n="  "+n}return{label:n,element:e}},initIssues:function(){var e=this,t=localStorage.getItem(a["a"]);Object(c["l"])().then((function(n){n&&Array.isArray(n)&&(e.currentIssue=n.find((function(e){return e.title===t})))})).catch((function(e){return console.log(e)})).finally((function(){e.currentIssue&&e.initComments(e.currentIssue.number)}))},initComments:function(e){var t=this;e&&Object(c["i"])(e).then((function(e){console.log("get Comments response",e),t.currentIssue=Object(r["a"])(Object(r["a"])({},t.currentIssue),{},{comments:e}),console.log("get Comments",t.currentIssue)})).catch((function(e){return console.log(e)}))},initDomTree:function(){var e=document.querySelector("#markdown-content");if(e){for(var t=Array.from(e.querySelectorAll("h1,h2,h3,h4,h5,h6")),n=[],o=0,s=t;o<s.length;o++){var r=s[o];n.push(this.treeDecoration(r))}this.$store.dispatch("app/setPostDirectory",n)}},addCommentEvent:function(e,t){var n=this,o={body:t};this.loading=this.$loading(u),Object(c["b"])(e,o).then((function(e){})).catch((function(e){console.log("addComment encounter error:",e),n.loading.close(),n.$message({message:"".concat(n.$t("messgae.unknownError")),type:"error"})})).finally((function(){n.initIssues(),n.loading.close()}))},handlerCommitComment:function(e){var t=this,n=sessionStorage.getItem(l["b"]);if(e.html&&e.issueId)console.log("issue 存在",e),this.addCommentEvent(e.issueId,e.html);else if(e.html){console.log("issue 不存在",e);var o=localStorage.getItem(a["a"]);Object(c["e"])({title:o,body:o}).then((function(n){var o=n.number;t.addCommentEvent(o,e.html)})).catch((function(e){console.log("createIssue encounter error:",e),t.$message({message:"".concat(t.$t("messgae.unknownError")),type:"error"})}))}else this.$message({message:"".concat(this.$t("messgae.unknownError")),type:"error"});console.log("details commit",e,n)},sign:function(e){if(console.log("signUp start",e),"signin"===e){var t=this.$route.params.sha;console.log("sha",t);var n=l["a"]+"?hash="+t;console.log(n),window.location.href=n}else"signout"===e&&this.$store.dispatch("user/logout")}}},m=h,g=n("2877"),d=Object(g["a"])(m,o,s,!1,null,null,null);t["default"]=d.exports}}]);